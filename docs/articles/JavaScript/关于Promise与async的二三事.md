> æœ€è¿‘å…³äº Promise çœ‹äº†å¥½ä¸€äº›æ–‡ç« æ¥é˜è¿°ç”¨é€”,å†åŠ ä¸Šå¼‚æ­¥ç¼–ç¨‹å’Œ async ä¸ await çš„ç”¨æ³•å¼„çš„å±å®å¤´å¤§,ä½†æ˜¯çœ‹äº†å¥½å‡ éä¹‹åæ„Ÿè§‰æœ‰ç‚¹ä¸Šé“äº†,ç„¶åæŠ“ç´§å§æˆ‘çŸ¥é“çš„ç†è§£çš„è®°å½•ä¸‹æ¥äº†,æˆ‘åœ¨è¿™é‡Œåªæ˜¯é˜è¿°æˆ‘å¯¹ Promise å’Œ async çš„ä¸€äº›ç†è§£,å…³äº promise å’Œ async çš„æ›´å¤šç»†èŠ‚å¯ä»¥å»æŸ¥çœ‹é˜®ä¸€å³°è€å¸ˆçš„[ES6 å…¥é—¨](https://es6.ruanyifeng.com/#docs/async),æˆ–è€…è¾¹åŸè€å¸ˆçš„[ç†è§£ JavaScript çš„ async/await](https://segmentfault.com/a/1190000007535316)

ç¬¬ä¸€æ¬¡å†™æ–‡ç« ,å¯èƒ½ä¼šæœ‰è¯­å¥ä¸é€šé¡ºæˆ–è€…æœ‰äº›ç†è§£é”™è¯¯çš„åœ°æ–¹,ä¹Ÿè¯·å¤šå¤šæŒ‡æ­£,å¤šå¤šæ‰¹è¯„ ğŸ˜„

### 1.å…³äºåŒæ­¥ä¸å¼‚æ­¥

js æ˜¯å•çº¿ç¨‹çš„,æ‰§è¡Œæ—¶åªèƒ½ç­‰å¾…å‰ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œå®Œæ¯•æ‰ä¼šæ‰§è¡Œä¸‹ä¸€ä¸ª,ä½†å½“å‰ä¸€ä¸ªä»»åŠ¡è€—æ—¶è¿‡é•¿æ—¶,å°±ä¼šå‘ç”Ÿé˜»å¡,å¦‚æœæ‰€æœ‰ä»»åŠ¡éƒ½æ˜¯åŒæ­¥æ‰§è¡Œçš„è¯,å°±å¯èƒ½ä¼šé€ æˆæµè§ˆå™¨å¡é¡¿ç­‰æƒ…å†µ,æ‰€ä»¥é‚£äº›æ‰§è¡Œæ—¶é—´å¾ˆé•¿çš„ä»»åŠ¡éƒ½åº”è¯¥å¼‚æ­¥æ¥å¤„ç†.å…³äºå¼‚æ­¥æ¨¡å¼ç¼–ç¨‹çš„å®ç°æ–¹å¼å¯ä»¥å…·ä½“å»å‚è€ƒé˜®ä¸€å³°è€å¸ˆçš„[Javascript å¼‚æ­¥ç¼–ç¨‹çš„ 4 ç§æ–¹æ³•](http://www.ruanyifeng.com/blog/2012/12/asynchronous%EF%BC%BFjavascript.html)

## 2.Promise

ç¬¬ä¸€æ¬¡æ¥è§¦ Promise æ—¶æ˜¯å»å¹´å­¦ Vue çš„æ—¶ç”¨åˆ°çš„ Axios åº“,é‡Œé¢çš„æ–¹æ³•å°è£…å¥½äº†ç›´æ¥ç”¨çš„æ—¶å€™å°±æ˜¯ä¸‹é¢è¿™ç§æ–¹æ³•,åæ¥åœ¨è¡¥ä¹ åŸºç¡€ä»¥åŠ ES6 æ˜¯æ‰çŸ¥é“è¿™åŸæ¥æ˜¯ç”¨ Promise å°è£…çš„,ä½†æ˜¯ç¢äºè„‘å­ç¬¨æ²¡æ€ä¹ˆç†è§£,å°±è¿˜æ˜¯åªæ˜¯ä¼šç”¨,åˆ°å‰æ®µæ—¶é—´åœ¨çœ‹çš„æ—¶å€™æœ‰é‚£ä¹ˆä¸€ç‚¹ç‚¹ç†è§£äº†.

```javascript
const data = {
  ...
};
services
    .getinfo(data)
    .then((res) => {
        console.log(res);
    })
    .catch((err) => {
        console.log(err);
    });

```

Promise æ˜¯å¼‚æ­¥ç¼–ç¨‹çš„ä¸€ä¸ªè§£å†³æ–¹æ¡ˆ,å®ƒæœ‰ä¸‰ä¸ªçŠ¶æ€,`pending`ï¼ˆæ­£åœ¨è¿›è¡Œï¼‰ã€`fulfilled`ï¼ˆæ‰§è¡ŒæˆåŠŸï¼‰å’Œ`rejected`ï¼ˆæ‰§è¡Œå¤±è´¥),è€Œä¸”åªæœ‰ä¸¤ç§çŠ¶æ€:A:æ­£åœ¨è¿›è¡Œ==>æ‰§è¡ŒæˆåŠŸ B:æ­£åœ¨è¿›è¡Œ==>æ‰§è¡Œå¤±è´¥ä¸”çŠ¶æ€ä¸€æ—¦å‘ç”Ÿå˜åŒ–,å°±ä¸ä¼šå†ç»§ç»­å˜äº†,æˆåŠŸå°±æ˜¯æˆäº†,å¤±è´¥å°±æ˜¯å¤±è´¥äº†,ä¸ä¼šå†å»å‘ç”Ÿå˜åŒ–,è¿™ç§ç»“æœä¼šä¸€ç›´æŒç»­åˆ°ä»»åŠ¡ç»“æŸ.è€Œä¸”åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æ˜¯æ— æ³•å–æ¶ˆçš„.ç”¨æ³•ä¸Š Promise æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°,å¯ä»¥ç”¨`new`å…³é”®å­—æ¥åˆ›å»ºä¸€ä¸ª Promise å¯¹è±¡,å®ƒæ¥å—ä¸¤ä¸ªå‡½æ•°å‚æ•°,åˆ†åˆ«æ˜¯`resolve`å’Œ`reject`,

```javascript
const myPromise = new Promise((resolve, reject) => {
  //æ¥å—ä¸¤ä¸ªå‚æ•° resolve, reject
  let num = 0
  setTimeout(() => {
    // æ‰§è¡Œä¸€ä¸ªå¼‚æ­¥æ“ä½œ
    num = Math.random() * 10 // ç”Ÿæˆä¸€ä¸ªéšæœºæ•°
    if (num > 5) {
      resolve(num) // å¦‚æœç¬¦åˆæ¡ä»¶,å°±å°†Promiseçš„çŠ¶æ€ä»æ­£åœ¨æ‰§è¡Œå˜ä¸ºæ‰§è¡ŒæˆåŠŸ
    } else reject(num) // å¦‚æœä¸ç¬¦åˆæ¡ä»¶å°±ä¼šå°†çŠ¶æ€ç”±æ­£åœ¨æ‰§è¡Œå˜ä¸ºæ‰§è¡Œå¤±è´¥
  }, 2000)
})
myPromise
  .then((p) => {
    // thenç”¨äºä¸ºPromiseå®ä¾‹æ·»åŠ çŠ¶æ€æ”¹å˜æ—¶çš„å›è°ƒ
    console.log(p)
  })
  .catch((e) => {
    // catchç”¨äºæŒ‡å®šå‘ç”Ÿé”™è¯¯æ—¶çš„å›è°ƒ
    console.log(e)
  })
```

æ¢å¥è¯è¯´å°±æ˜¯æ‰§è¡ŒæˆåŠŸå°±åœ¨æ‰§è¡Œ then æ–¹æ³•,æ‰§è¡Œå¤±è´¥å°±å»æ‰§è¡Œ catch æ–¹æ³•

```javascript
const myPromise = new Promise((resolve, reject) => {
  const num = Math.random() * 10
  if (num > 5) {
    resolve(num)
  } else reject(num)
})
myPromise
  .then((p) => {
    console.log(p)
  })
  .catch((e) => {
    console.log(e)
  })
console.log(1) // æ³¨æ„!!
//æ‰§è¡Œç»“æœæ˜¯
//1
//7.696298823399228
```

è¿™é‡Œçš„ myPromise åˆ›å»ºå®Œåç«‹å³æ‰§è¡Œ,ä½†æ˜¯å› ä¸ºæ˜¯å¼‚æ­¥çš„, `then`æ–¹æ³•æŒ‡å®šçš„å›è°ƒå‡½æ•°å°†åœ¨å½“å‰è„šæœ¬æ‰€æœ‰åŒæ­¥ä»»åŠ¡æ‰§è¡Œå®Œåæ‰ä¼šæ‰§è¡Œ,æ‰€ä»¥æ‰ä¼šæœ€åè¾“å‡ºéšæœºæ•°åœ¨ç½‘é¡µçš„å›¾ç‰‡åŠ è½½æ—¶,æˆ‘ä»¬å¾€å¾€ç”¨çš„éƒ½æ˜¯å¼‚æ­¥çš„,åœ¨æ‰§è¡Œ JS æ—¶ä¼šå»å‘é€è¯·æ±‚,ç­‰åˆ°ä¸»çº¿ç¨‹æ‰§è¡Œå®Œäº†,å›¾ç‰‡ä¹Ÿè¯·æ±‚å®Œäº†é‚£ä¹ˆå›¾ç‰‡å°±ä¼šæ˜¾ç¤ºäº†.æˆ‘å¯¹`Promise`çš„ç†è§£çš„å¯èƒ½ä¸æ˜¯ç‰¹åˆ«çš„æ·±,æ‰€ä»¥è¯·è§è°….

Promise çš„ç¼ºç‚¹

1. æ— æ³•å–æ¶ˆ`Promise`,ä¸€æ—¦æ–°å»ºå®ƒå°±ä¼šç«‹å³æ‰§è¡Œ,æ— æ³•ä¸­é€”å–æ¶ˆ
2. å¦‚æœä¸è®¾ç½®å›è°ƒå‡½æ•°,`Promise`å†…éƒ¨æŠ›å‡ºçš„é”™è¯¯,ä¸ä¼šååº”åˆ°å¤–éƒ¨
3. å½“å¤„äº`Pending`çŠ¶æ€æ—¶,æ— æ³•å¾—çŸ¥ç›®å‰è¿›å±•åˆ°å“ªä¸€ä¸ªé˜¶æ®µï¼ˆåˆšåˆšå¼€å§‹è¿˜æ˜¯å³å°†å®Œæˆï¼‰

## 3.async ä¸ await

async å…¶å®å°±æ˜¯å¼‚æ­¥(asynchronous)

> `async`å‡½æ•°è¿”å›ä¸€ä¸ª Promise å¯¹è±¡,å¯ä»¥ä½¿ç”¨`then`æ–¹æ³•æ·»åŠ å›è°ƒå‡½æ•° ï¼ˆå®ƒå°±æ˜¯ Generator å‡½æ•°çš„è¯­æ³•ç³–ï¼‰
> å½“å‡½æ•°æ‰§è¡Œçš„æ—¶å€™,ä¸€æ—¦é‡åˆ°`await`å°±ä¼šå…ˆè¿”å›,ç­‰åˆ°å¼‚æ­¥æ“ä½œå®Œæˆ,å†æ¥ç€æ‰§è¡Œå‡½æ•°ä½“å†…åé¢çš„è¯­å¥

```javascript
async function fun() {
  const result = 'helloworld'
  return result
}
fun()
```

è¿è¡Œç»“æœ:![image.png](/js/await.png)å¯ä»¥å‘ç°,`async`å‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ª Promise å¯¹è±¡,è€Œä¸” async å‡½æ•°ä¸­çš„ return çš„è¿”å›å€¼å¯ä»¥åšä¸º Promise ä¸­ then æ–¹æ³•çš„å›è°ƒçš„å‚æ•°,å¦‚æœæŠ›å‡ºäº†å¼‚å¸¸,ä¹Ÿå¯ç”¨ catch æ–¹æ³•æ¥å¤„ç†,ä¸”åªæœ‰`async`å‡½æ•°å†…éƒ¨çš„å¼‚æ­¥æ“ä½œæ‰§è¡Œå®Œ,æ‰ä¼šæ‰§è¡Œ`then`æ–¹æ³•æŒ‡å®šçš„å›è°ƒå‡½æ•°.æ—¢ç„¶ async è¿”å›äº†ä¸€ä¸ª Promise å¯¹è±¡,é‚£ä¹ˆ await çš„ä½œç”¨æ˜¯ä»€ä¹ˆå‘¢?æ­£å¸¸æƒ…å†µä¸‹,`await`å‘½ä»¤åé¢æ˜¯ä¸€ä¸ª Promise å¯¹è±¡,è¿”å›è¯¥å¯¹è±¡çš„ç»“æœ.å¦‚æœä¸æ˜¯ Promise å¯¹è±¡,å°±ç›´æ¥è¿”å›å¯¹åº”çš„å€¼.

```javascript
async function fun() {
  return await 'tom'
}
fun.then((p) => {
  console.log(p)
})

// tom
```

await åé¢çš„å€¼å¹¶ä¸ä¸€å®šæ˜¯ä¸€ä¸ª Promise å¯¹è±¡,ä¹Ÿå°±æ˜¯è¯´,å¦‚æœ await åé¢çš„ä¸æ˜¯ä¸€ä¸ª Promise å¯¹è±¡,é‚£ä¹ˆè¿™ä¸ªå€¼å°±æ˜¯è¦"ç­‰å¾…"çš„å¤„ç†ç»“æœåŠ äº† await ä¹‹å,await åé¢çš„è¯­å¥éƒ½ä¼šå˜æˆåŒæ­¥çš„,æŒ‰ç…§é¡ºåºæ¥æ‰§è¡Œè¯­å¥,

```javascript
function myPromise(num) {
  return new Promise((resolve, reject) => {
    setTimeout(() => {
      resolve(num)
    }, 2000)
  })
}
async function fun() {
  let a = await myPromise(1)
  let b = await myPromise(2)
  let c = await myPromise(3)
  console.log(a, b, c)
  console.log('is end')
}
fun()
//1,2,3
//is end
```

ä½†æ˜¯è¿˜æœ‰ä¸€ç‚¹è¦æ³¨æ„æ˜¯åœ¨ await åé¢çš„å¼‚æ­¥è¯­å¥å¦‚æœæŠ›å‡ºå¼‚å¸¸,å°±ä¼šæ—¶æ•´ä¸ªå‡½æ•°ä¸­æ–­æ‰§è¡Œ

```javascript
//æŠŠä¸Šé¢çš„ä»£ç è¿›è¡Œä¿®æ”¹
const myPromis = () => {
  return new Promise((resolve, reject) => {
    let num = 0
    setTimeout(() => {
      num = Math.random() * 10
      if (num > 5) {
        resolve(num)
      } else reject(num)
    }, 2000)
  })
}
async function fun() {
  let a = await myPromis()
  console.log(a)
  console.log('is end ')
}
fun()
```

æ‰§è¡Œç»“æœ:![image.png](/js/await2.png)ç»“æœæ˜¯ 3.75 å°äº 5,æ‰§è¡Œ reject,æŠ›å‡ºå¼‚å¸¸,ä½†æ˜¯å¯ä»¥ç”¨ try...catch...æ¥æ”¹å†™`fun()`

```javascript
async function fun() {
  let a = 0
  try {
    a = await myPromis() // å¤§äº5æ‰§è¡Œtryè¯­å¥
  } catch (e) {
    // å°äºäº”æŠ›å‡ºå¼‚å¸¸æ‰§è¡Œcatchè¯­å¥
    console.log(e)
    a = 100
  }
  console.log(a)
  console.log('is end ')
}
```

æ€»çš„æ¥è¯´ ssync ä¸ await å°±æ˜¯å¯ä»¥ç®€åŒ– Promise,ä½¿å…¶æ›´ç›´è§‚çš„ä½†è¦æ³¨æ„ async ä¸ await çš„ä½¿ç”¨:

- await å…³é”®å­—å¿…é¡»ä½äº async å‡½æ•°å†…éƒ¨
- ä¸èƒ½åœ¨æ™®é€šç®­å¤´å‡½æ•°ä¸­ä½¿ç”¨ await å…³é”®å­—,éœ€è¦åœ¨ç®­å¤´å‡½æ•°å‰é¢æ·»åŠ  async
